<!doctype html>

<body>
    <canvas id="canvas" width="1850" height="900"></canvas>

    <script>
        var canvas, canvasContext, imageAssets;

        window.onload = function () {
            canvas = document.getElementById("canvas");
            canvasContext = canvas.getContext("2d");
            imageAssets = loadImgAssets();

            document.body.style.background = 'black';
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 50);
        }

        var player1Xpos = 300;
        var player1Ypos = 730;
        var player1Xspeed = 12;
        var player1Yspeed = 5;
        const PLAYER1_SIZE = 200;
        const PLAYER1_WIDTH = 200;
        const PLAYER1_HEIGHT = 200;

        var player2Xpos = 1400;
        var player2Ypos = 730;
        var player2Xspeed = 12;
        var player2Yspeed = 5;
        const PLAYER2_WIDTH = 200;
        const PLAYER2_HEIGHT = 200;

        var attack1Xpos = '';
        var attack1Ypos = '';
        var ATTACK1_WIDTH = 170;
        var ATTACK1_HEIGHT = 100;

        var attack2Xpos = '';
        var attack2Ypos = '';
        var ATTACK2_WIDTH = 170;
        var ATTACK2_HEIGHT = 100;

        var health1Xpos = 50;
        var health1Ypos = 50;
        var HEALTH1_WIDTH = 750;
        var HEALTH1_HEIGHT = 75;

        var healthloss1Xpos = 50;
        var healthloss1Ypos = 50;
        var HEALTHLOSS1_WIDTH = 0;
        var HEALTHLOSS1_HEIGHT = 75;

        var health2Xpos = 1050;
        var health2Ypos = 50;
        var HEALTH2_WIDTH = 750;
        var HEALTH2_HEIGHT = 75;

        var healthloss2Xpos = 1050;
        var healthloss2Ypos = 50;
        var HEALTHLOSS2_WIDTH = 750;
        var HEALTHLOSS2_HEIGHT = 75;

        var centerboxXpos = health1Xpos + HEALTH1_WIDTH;
        var centerboxYpos = 14;
        var CENTERBOX_WIDTH = 250;
        var CENTERBOX_HEIGHT = 150;

        const D_KEY = 68;
        const A_KEY = 65;
        const W_KEY = 87;
        const SPACE_KEY = 32;

        const RIGHT_KEY = 39;
        const LEFT_KEY = 37;
        const UP_KEY = 38;
        const DOWN_KEY = 40;

        var dKeyPressed = false;
        var aKeyPressed = false;
        var wKeyPressed = false;
        var spaceKeyPressed = false;

        var rightKeyPressed = false;
        var leftKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        var background = new Image();
        background.src = "images/bg1.png";

        var winbox = new Image();
        winbox.src = "images/winbox.png";

        var round = 1;

        var point1 = 0;
        var point2 = 0;

        var winner = '';
        var gameRun = true;

        function mainloop() {
            if (gameRun) {

                drawImg(background, 0, 0, canvas.width, canvas.height);
                colorRect(health1Xpos, health1Ypos, HEALTH1_WIDTH, HEALTH1_HEIGHT, 'lime');
                colorRect(healthloss1Xpos, healthloss1Ypos, HEALTHLOSS1_WIDTH, HEALTHLOSS1_HEIGHT, 'red');
                colorRect(healthloss2Xpos, healthloss2Ypos, HEALTHLOSS2_WIDTH, HEALTHLOSS2_HEIGHT, 'red');
                colorRect(health2Xpos, health2Ypos, HEALTH2_WIDTH, HEALTH2_HEIGHT, 'lime');
                colorRect(centerboxXpos, centerboxYpos, CENTERBOX_WIDTH, CENTERBOX_HEIGHT, 'grey');
                colorText('Round', canvas.width / 2.174, canvas.height / 13, '50px Arial', 'white');
                colorText(round, canvas.width / 2.04, canvas.height / 6.5, '70px Arial', 'white');
                colorText('points: ' + point1, health1Xpos, canvas.height / 5, '50px Arial', 'white');
                colorText('points: ' + point2, canvas.width / 1.15, canvas.height / 5, '50px Arial', 'white');
                colorRect(player1Xpos, player1Ypos, PLAYER1_WIDTH, PLAYER1_HEIGHT, 'red');
                colorRect(player2Xpos, player2Ypos, PLAYER2_WIDTH, PLAYER2_HEIGHT, 'blue');
                colorRect(attack1Xpos, attack1Ypos, ATTACK1_WIDTH, ATTACK1_HEIGHT, 'grey');
                colorRect(attack2Xpos, attack2Ypos, ATTACK2_WIDTH, ATTACK2_HEIGHT, 'grey');

                PlayerMove()
                AttackAppear()

            } else {
                gameRun = false;
                drawImg(winbox, canvas.width / 3.5, canvas.height / 3, 800, 400);
                colorText(winner + ' wins', canvas.width / 2.36, canvas.height / 2, '50px Arial', 'white');
                colorText('final score:', canvas.width / 2.14, canvas.height / 1.78, '30px Arial', 'white');
                colorText(point1 + ' - ' + point2, canvas.width / 2.155, canvas.height / 1.53, '80px Arial', 'white');
                if (winner == 'Player 1') {
                    colorRect(healthloss2Xpos, healthloss2Ypos, HEALTHLOSS2_WIDTH, HEALTHLOSS2_HEIGHT, 'red');
                }
                if (winner == 'Player 2') {
                    colorRect(health1Xpos, health1Ypos, HEALTH1_WIDTH, HEALTH1_HEIGHT, 'red');
                }
            }

            if (point1 == 2) {
                winner = 'Player 1'
                gameRun = false;
            }
            if (point2 == 2) {
                winner = 'Player 2'
                gameRun = false;
            }

            if (round == 2) {
                var background2 = new Image();
                background.src = "images/bg2.png";
            }
            if (round == 3) {
                var background2 = new Image();
                background.src = "images/bg3.png";
            }
        }

        function loadImgAssets() {
            imgs = {};
            return imgs;
        }

        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }

        function colorText(msg, x, y, f, c) {
            canvasContext.font = f;
            canvasContext.fillStyle = c;
            canvasContext.fillText(msg, x, y);
        }

        function drawImg(src, x, y, w, h) {
            canvasContext.drawImage(src, x, y, w, h);
        }

        function keyPressed(evt) {
            if (evt.keyCode == D_KEY) {
                dKeyPressed = true;
            }
            if (evt.keyCode == A_KEY) {
                aKeyPressed = true;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = true;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = true;
                setTimeout(() => {
                    spaceKeyPressed = false
                }, 100)
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
                setTimeout(() => {
                    downKeyPressed = false
                }, 100)
            }
        }

        function keyReleased(evt) {
            if (evt.keyCode == D_KEY) {
                dKeyPressed = false;
            }
            if (evt.keyCode == A_KEY) {
                aKeyPressed = false;
            }
            if (evt.keyCode == W_KEY) {
                wKeyPressed = false;
            }
            if (evt.keyCode == SPACE_KEY) {
                spaceKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            }
        }

        function AttackAppear() {
            if (spaceKeyPressed && player1Xpos + PLAYER1_WIDTH < player2Xpos + PLAYER2_WIDTH) {
                attack1Xpos = player1Xpos + PLAYER1_WIDTH;
                attack1Ypos = player1Ypos;
                ATTACK1_WIDTH = 170;
                ATTACK1_HEIGHT = 100;

            } else if (spaceKeyPressed && player1Xpos + PLAYER1_WIDTH > player2Xpos + PLAYER2_WIDTH) {
                attack1Xpos = player1Xpos - PLAYER1_WIDTH * 0.85;
                attack1Ypos = player1Ypos;
                ATTACK1_WIDTH = 170;
                ATTACK1_HEIGHT = 100;

            } else {
                ATTACK1_WIDTH = 0;
                ATTACK1_HEIGHT = 0;
                attack1Ypos = canvas.height * 0.01;
            }

            if (downKeyPressed && player2Xpos > player1Xpos) {
                attack2Xpos = player2Xpos - PLAYER2_WIDTH * 0.85;
                attack2Ypos = player2Ypos;
                ATTACK2_WIDTH = 170;
                ATTACK2_HEIGHT = 100;

            } else if (downKeyPressed && player2Xpos < player1Xpos) {
                attack2Xpos = player2Xpos + PLAYER2_WIDTH;
                attack2Ypos = player2Ypos;
                ATTACK2_WIDTH = 170;
                ATTACK2_HEIGHT = 100;

            } else {
                ATTACK2_WIDTH = 0;
                ATTACK2_HEIGHT = 0;
                attack2Ypos = canvas.height * 0.01;
            }

            if (player2Xpos < attack1Xpos + ATTACK1_WIDTH &&
                player2Xpos + PLAYER2_WIDTH > attack1Xpos &&
                player2Ypos < attack1Ypos + ATTACK1_HEIGHT &&
                player2Ypos + PLAYER2_HEIGHT > attack1Ypos && HEALTH2_WIDTH > 0) { // when sword hits boss
                console.log("hit");
                HEALTH2_WIDTH -= 10
            }
            if (HEALTH2_WIDTH <= 0 && point1 < 2) {
                console.log("dead");
                HEALTH2_WIDTH = 750;
                HEALTHLOSS1_WIDTH = 0;
                round++;
                point1++;
                player1Xpos = 300;
                player2Xpos = 1400;
            }

            if (player1Xpos < attack2Xpos + ATTACK2_WIDTH &&
                player1Xpos + PLAYER1_WIDTH > attack2Xpos &&
                player1Ypos < attack2Ypos + ATTACK2_HEIGHT &&
                player1Ypos + PLAYER1_HEIGHT > attack2Ypos && HEALTHLOSS1_WIDTH < 750) { // when sword hits boss
                console.log("hit");
                HEALTHLOSS1_WIDTH += 10
            }
            if (HEALTHLOSS1_WIDTH >= 750 && point2 < 2) {
                console.log("dead");
                HEALTHLOSS1_WIDTH = 0;
                HEALTH2_WIDTH = 750;
                round++;
                point2++;
                player1Xpos = 300;
                player2Xpos = 1400;
            }
        }

        function PlayerMove() {
            if (dKeyPressed && player1Xpos < canvas.width * .895) {
                player1Xpos += player1Xspeed
            }
            if (aKeyPressed && player1Xpos > canvas.width * .001) {
                player1Xpos -= player1Xspeed
            }
            player1Ypos += player1Yspeed;
            player1Yspeed += 3;
            if (player1Ypos <= 0) {
                player1Ypos = 0;
                player1Yspeed = 0.5;
            }
            if (round == 1) {
                if (wKeyPressed && player1Ypos + PLAYER1_HEIGHT > canvas.height * .966) {
                    player1Yspeed = -50;
                }
                if (player1Ypos + PLAYER1_HEIGHT >= canvas.height * .966) {
                    player1Ypos = canvas.height * .966 - PLAYER1_HEIGHT;
                }
            }
            if (round == 2) {
                if (wKeyPressed && player1Ypos + PLAYER1_HEIGHT > canvas.height * .893) {
                    player1Yspeed = -50;
                }
                if (player1Ypos + PLAYER1_HEIGHT >= canvas.height * .893) {
                    player1Ypos = canvas.height * .893 - PLAYER1_HEIGHT;
                }
            }
            if (round == 3) {
                if (wKeyPressed && player1Ypos + PLAYER1_HEIGHT > canvas.height * .78) {
                    player1Yspeed = -50;
                }
                if (player1Ypos + PLAYER1_HEIGHT >= canvas.height * .78) {
                    player1Ypos = canvas.height * .78 - PLAYER1_HEIGHT;
                }
            }

            if (rightKeyPressed && player2Xpos < canvas.width * .89) {
                player2Xpos += player2Xspeed
            }
            if (leftKeyPressed && player2Xpos > canvas.width * .001) {
                player2Xpos -= player2Xspeed
            }
            player2Ypos += player2Yspeed;
            player2Yspeed += 3;
            if (player2Ypos <= 0) {
                player2Ypos = 0;
                player2Yspeed = 0.5;
            }
            if (round == 1) {
                if (upKeyPressed && player2Ypos + PLAYER2_HEIGHT > canvas.height * .966) {
                    player2Yspeed = -50;
                }
                if (player2Ypos + PLAYER2_HEIGHT >= canvas.height * .966) {
                    player2Ypos = canvas.height * .966 - PLAYER2_HEIGHT;
                }
            }
            if (round == 2) {
                if (upKeyPressed && player2Ypos + PLAYER2_HEIGHT > canvas.height * .893) {
                    player2Yspeed = -50;
                }
                if (player2Ypos + PLAYER2_HEIGHT >= canvas.height * .893) {
                    player2Ypos = canvas.height * .893 - PLAYER2_HEIGHT;
                }
            }
            if (round == 3) {
                if (upKeyPressed && player2Ypos + PLAYER2_HEIGHT > canvas.height * .78) {
                    player2Yspeed = -50;
                }
                if (player2Ypos + PLAYER2_HEIGHT >= canvas.height * .78) {
                    player2Ypos = canvas.height * .78 - PLAYER2_HEIGHT;
                }
            }
        }
    </script>
</body>